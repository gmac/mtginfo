define(["jquery.scrollto","underscore","backbone","./grid-m","./settings-m","./layout-c"],function(e,t,n,r,i,s){var o=n.View.extend({el:"#grid",rows:0,cols:0,initialize:function(){var n=this;this.listenTo(i,"change:gridSize",this.resetGrid,this),this.listenTo(r,"add remove reset",this.render,this),this.listenTo(s,"left",this.setLeft,this),this.$win=e(window).on("resize",t.throttle(function(){n.resetGrid()},100))},render:function(){var n="";this.tmpl=this.tmpl||t.template(e("#grid-item-tmpl").html()),r.each(function(e){n+=this.tmpl(e.toJSON())},this),this.$el.html(n),this.resetGrid(),this.selectIndex(0)},keypress:function(e,t){if(e>=49&&e<=57)return t?this.openSelected():this.selectVisibleIndex(e-49),!0;if(e>=37&&e<=40){var n=0,r=0;switch(e){case 37:n=-1;break;case 38:r=-1;break;case 39:n=1;break;case 40:r=1}return this.shiftSelectionBy(n,r),!0}return e==8?(this.removeSelected(),!0):e==13?(this.openSelected(),!0):!1},setLeft:function(e){this.$el.css("left",e)},openSelected:function(){var e=s.selectedIndex();if(e>=0&&e<r.length){var t=r.at(e);open(t.get("url"),"_blank")}},removeSelected:function(){var e=s.selectedIndex();e>=0&&(this.removeIndex(e),this.selectIndex(e))},clearSelection:function(){this.selectIndex(-1)},selectIndex:function(t){t=Math.max(-1,Math.min(t,r.length-1));if(t>=0){var n=this.$(".card:eq("+t+")");e.scrollTo(n,500,{offset:{top:-(s.top+10),left:0}}),s.select(n)}else s.deselect()},selectVisibleIndex:function(e){var t=this.$win.scrollTop()+s.top,n=this.$el.find(":first-child").outerHeight(),r=Math.round(t/n);this.selectIndex(this.cols*r+e)},removeIndex:function(e){r.removeCard(e)},shiftSelectionBy:function(e,t){var n=s.selectedIndex();n>=0&&(n+=e+t*this.cols,n=Math.max(0,Math.min(n,r.length-1)),this.selectIndex(n))},resetGrid:function(){var e=312,t=445,n=20,s=3,o=this.$win.width(),u=(e+2+n)*(1/s)*i.get("gridSize"),a=Math.round(o/u),f=Math.floor((100-a)/a)-1;this.$el.children().css({marginLeft:"1%",marginTop:"1%",width:f+"%"}),this.rows=Math.floor(r.length/a),this.cols=a},events:{"click .remove":"onRemove"},onRemove:function(t){var n=e(t.target).closest(".card");this.removeIndex(n.index())}});return new o});