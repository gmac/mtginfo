// (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
// Backbone may be freely distributed under the MIT license.
// For all details and documentation:
// http://backbonejs.org

define("backbone",["jquery","underscore"],function(e,t){var n={};return function(){var e=this,t=e.Backbone,r=[],i=r.push,s=r.slice,o=r.splice,u;u="undefined"!=typeof n?n:e.Backbone={},u.VERSION="0.9.10";var a=e._;!a&&"undefined"!=typeof require&&(a=require("underscore")),u.$=e.jQuery||e.Zepto||e.ender,u.noConflict=function(){return e.Backbone=t,this},u.emulateHTTP=!1,u.emulateJSON=!1;var f=/\s+/,l=function(e,t,n,r){if(!n)return!0;if("object"==typeof n)for(var i in n)e[t].apply(e,[i,n[i]].concat(r));else{if(!f.test(n))return!0;n=n.split(f),i=0;for(var s=n.length;i<s;i++)e[t].apply(e,[n[i]].concat(r))}},c=function(e,t){var n,r=-1,i=e.length;switch(t.length){case 0:for(;++r<i;)(n=e[r]).callback.call(n.ctx);break;case 1:for(;++r<i;)(n=e[r]).callback.call(n.ctx,t[0]);break;case 2:for(;++r<i;)(n=e[r]).callback.call(n.ctx,t[0],t[1]);break;case 3:for(;++r<i;)(n=e[r]).callback.call(n.ctx,t[0],t[1],t[2]);break;default:for(;++r<i;)(n=e[r]).callback.apply(n.ctx,t)}},r=u.Events={on:function(e,t,n){return!l(this,"on",e,[t,n])||!t?this:(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:n,ctx:n||this}),this)},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var r=this,i=a.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n),this},off:function(e,t,n){var r,i,s,o,u,f,c,h;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:a.keys(this._events),u=0;for(f=o.length;u<f;u++)if(e=o[u],r=this._events[e]){s=[];if(t||n){c=0;for(h=r.length;c<h;c++)i=r[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&s.push(i)}this._events[e]=s}return this},trigger:function(e){if(!this._events)return this;var t=s.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&c(n,t),r&&c(r,arguments),this},listenTo:function(e,t,n){var r=this._listeners||(this._listeners={}),i=e._listenerId||(e._listenerId=a.uniqueId("l"));return r[i]=e,e.on(t,"object"==typeof t?this:n,this),this},stopListening:function(e,t,n){var r=this._listeners;if(r){if(e)e.off(t,"object"==typeof t?this:n,this),!t&&!n&&delete r[e._listenerId];else{"object"==typeof t&&(n=this);for(var i in r)r[i].off(t,n,this);this._listeners={}}return this}}};r.bind=r.on,r.unbind=r.off,a.extend(u,r);var h=u.Model=function(e,t){var n,r=e||{};this.cid=a.uniqueId("c"),this.attributes={},t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(r=this.parse(r,t)||{});if(n=a.result(this,"defaults"))r=a.defaults({},r,n);this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};a.extend(h.prototype,r,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(){return a.clone(this.attributes)},sync:function(){return u.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return a.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var r,i,s,o,u,f,l;if(null==e)return this;"object"==typeof e?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,o=n.silent,e=[],u=this._changing,this._changing=!0,u||(this._previousAttributes=a.clone(this.attributes),this.changed={}),l=this.attributes,f=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],a.isEqual(l[r],t)||e.push(r),a.isEqual(f[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete l[r]:l[r]=t;if(!o){e.length&&(this._pending=!0),t=0;for(r=e.length;t<r;t++)this.trigger("change:"+e[t],this,l[e[t]],n)}if(u)return this;if(!o)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._changing=this._pending=!1,this},unset:function(e,t){return this.set(e,void 0,a.extend({},t,{unset:!0}))},clear:function(e){var t={},n;for(n in this.attributes)t[n]=void 0;return this.set(t,a.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!a.isEmpty(this.changed):a.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?a.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes,i;for(i in e)a.isEqual(r[i],t=e[i])||((n||(n={}))[i]=t);return n},previous:function(e){return null==e||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return a.clone(this._previousAttributes)},fetch:function(e){e=e?a.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success;return e.success=function(e,n,r){if(!e.set(e.parse(n,r),r))return!1;t&&t(e,n,r)},this.sync("read",this,e)},save:function(e,t,n){var r,i,s=this.attributes;return null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t,r&&(!n||!n.wait)&&!this.set(r,n)?!1:(n=a.extend({validate:!0},n),this._validate(r,n)?(r&&n.wait&&(this.attributes=a.extend({},s,r)),void 0===n.parse&&(n.parse=!0),i=n.success,n.success=function(e,t,n){e.attributes=s;var o=e.parse(t,n);n.wait&&(o=a.extend(r||{},o));if(a.isObject(o)&&!e.set(o,n))return!1;i&&i(e,t,n)},e=this.isNew()?"create":n.patch?"patch":"update","patch"===e&&(n.attrs=r),e=this.sync(e,this,n),r&&n.wait&&(this.attributes=s),e):!1)},destroy:function(e){e=e?a.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(e,t,i){(i.wait||e.isNew())&&r(),n&&n(e,t,i)};if(this.isNew())return e.success(this,null,e),!1;var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=a.result(this,"urlRoot")||a.result(this.collection,"url")||L();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return!this.validate||!this.validate(this.attributes,e)},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=a.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,t||{}),!1):!0}});var p=u.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this.models=[],this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,a.extend({silent:!0},t))};a.extend(p.prototype,r,{model:h,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return u.sync.apply(this,arguments)},add:function(e,t){e=a.isArray(e)?e.slice():[e],t||(t={});var n,r,s,u,f,l,c,h,p,d;c=[],h=t.at,p=this.comparator&&null==h&&0!=t.sort,d=a.isString(this.comparator)?this.comparator:null,n=0;for(r=e.length;n<r;n++)(s=this._prepareModel(u=e[n],t))?(f=this.get(s))?t.merge&&(f.set(u===s?s.attributes:u,t),p&&!l&&f.hasChanged(d)&&(l=!0)):(c.push(s),s.on("all",this._onModelEvent,this),this._byId[s.cid]=s,null!=s.id&&(this._byId[s.id]=s)):this.trigger("invalid",this,u,t);c.length&&(p&&(l=!0),this.length+=c.length,null!=h?o.apply(this.models,[h,0].concat(c)):i.apply(this.models,c)),l&&this.sort({silent:!0});if(t.silent)return this;n=0;for(r=c.length;n<r;n++)(s=c[n]).trigger("add",s,this,t);return l&&this.trigger("sort",this,t),this},remove:function(e,t){e=a.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s;n=0;for(r=e.length;n<r;n++)if(s=this.get(e[n]))delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s);return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,a.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,a.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){if(null!=e)return this._idAttr||(this._idAttr=this.model.prototype.idAttribute),this._byId[e.id||e.cid||e[this._idAttr]||e]},at:function(e){return this.models[e]},where:function(e){return a.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){if(!this.comparator)throw Error("Cannot sort a set without a comparator");return e||(e={}),a.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(a.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return a.invoke(this.models,"get",e)},update:function(e,t){t=a.extend({add:!0,merge:!0,remove:!0},t),t.parse&&(e=this.parse(e,t));var n,r,i,s,o=[],u=[],f={};a.isArray(e)||(e=e?[e]:[]);if(t.add&&!t.remove)return this.add(e,t);r=0;for(i=e.length;r<i;r++)n=e[r],s=this.get(n),t.remove&&s&&(f[s.cid]=!0),(t.add&&!s||t.merge&&s)&&o.push(n);if(t.remove){r=0;for(i=this.models.length;r<i;r++)n=this.models[r],f[n.cid]||u.push(n)}return u.length&&this.remove(u,t),o.length&&this.add(o,t),this},reset:function(e,t){t||(t={}),t.parse&&(e=this.parse(e,t));for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models.slice(),this._reset(),e&&this.add(e,a.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?a.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success;return e.success=function(e,n,r){e[r.update?"update":"reset"](n,r),t&&t(e,n,r)},this.sync("read",this,e)},create:function(e,t){t=t?a.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models.length=0,this._byId={}},_prepareModel:function(e,t){if(e instanceof h)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:!1},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){("add"===e||"remove"===e)&&n!==this||("destroy"===e&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=a.isFunction(t)?t:function(e){return e.get(t)};return a.sortedIndex(this.models,e,r,n)}}),a.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without indexOf shuffle lastIndexOf isEmpty chain".split(" "),function(e){p.prototype[e]=function(){var t=s.call(arguments);return t.unshift(this.models),a[e].apply(a,t)}}),a.each(["groupBy","countBy","sortBy"],function(e){p.prototype[e]=function(t,n){var r=a.isFunction(t)?t:function(e){return e.get(t)};return a[e](this.models,r,n)}});var d=u.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},v=/\((.*?)\)/g,m=/(\(\?)?:\w+/g,g=/\*\w+/g,y=/[\-{}\[\]+?.,\\\^$|#\s]/g;a.extend(d.prototype,r,{initialize:function(){},route:function(e,t,n){return a.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),u.history.route(e,a.bind(function(r){r=this._extractParameters(e,r),n&&n.apply(this,r),this.trigger.apply(this,["route:"+t].concat(r)),this.trigger("route",t,r),u.history.trigger("route",this,t,r)},this)),this},navigate:function(e,t){return u.history.navigate(e,t),this},_bindRoutes:function(){if(this.routes)for(var e,t=a.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(y,"\\$&").replace(v,"(?:$1)?").replace(m,function(e,t){return t?e:"([^/]+)"}).replace(g,"(.*?)"),RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var b=u.History=function(){this.handlers=[],a.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},w=/^[#\/]|\s+$/g,E=/^\/+|\/+$/g,S=/msie [\w.]+/,x=/\/$/;b.started=!1,a.extend(b.prototype,r,{interval:50,getHash:function(e){return(e=(e||this).location.href.match(/#(.*)$/))?e[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(x,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(w,"")},start:function(e){if(b.started)throw Error("Backbone.history has already been started");b.started=!0,this.options=a.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.options.pushState||!this.history||!this.history.pushState),e=this.getFragment();var t=document.documentMode,t=S.exec(navigator.userAgent.toLowerCase())&&(!t||7>=t);this.root=("/"+this.root+"/").replace(E,"/"),t&&this._wantsHashChange&&(this.iframe=u.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?u.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!t?u.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e,e=this.location,t=e.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!t)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&t&&e.hash&&(this.fragment=this.getHash().replace(w,""),this.history.replaceState({},document.title,this.root+this.fragment+e.search));if(!this.options.silent)return this.loadUrl()},stop:function(){u.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),b.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe)));if(e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e);return a.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0})},navigate:function(e,t){if(!b.started)return!1;if(!t||!0===t)t={trigger:t};e=this.getFragment(e||"");if(this.fragment!==e){this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,n){n?(n=e.href.replace(/(javascript:|#).*$/,""),e.replace(n+"#"+t)):e.hash="#"+t}}),u.history=new b;var T=u.View=function(e){this.cid=a.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},N=/^(\S+)\s*(.*)$/,C="model collection el id attributes className tagName events".split(" ");a.extend(T.prototype,r,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof u.$?e:u.$(e),this.el=this.$el[0],!1!==t&&this.delegateEvents(),this},delegateEvents:function(e){if(e||(e=a.result(this,"events"))){this.undelegateEvents();for(var t in e){var n=e[t];a.isFunction(n)||(n=this[e[t]]);if(!n)throw Error('Method "'+e[t]+'" does not exist');var r=t.match(N),i=r[1],r=r[2],n=a.bind(n,this),i=i+(".delegateEvents"+this.cid);""===r?this.$el.on(i,n):this.$el.on(i,r,n)}}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=a.extend({},a.result(this,"options"),e)),a.extend(this,a.pick(e,C)),this.options=e},_ensureElement:function(){if(this.el)this.setElement(a.result(this,"el"),!1);else{var e=a.extend({},a.result(this,"attributes"));this.id&&(e.id=a.result(this,"id")),this.className&&(e["class"]=a.result(this,"className")),e=u.$("<"+a.result(this,"tagName")+">").attr(e),this.setElement(e,!1)}}});var k={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};u.sync=function(e,t,n){var r=k[e];a.defaults(n||(n={}),{emulateHTTP:u.emulateHTTP,emulateJSON:u.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=a.result(t,"url")||L()),null==n.data&&t&&("create"===e||"update"===e||"patch"===e)&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}"GET"!==i.type&&!n.emulateJSON&&(i.processData=!1);var o=n.success;n.success=function(e){o&&o(t,e,n),t.trigger("sync",t,e,n)};var f=n.error;return n.error=function(e){f&&f(t,e,n),t.trigger("error",t,e,n)},e=n.xhr=u.ajax(a.extend(i,n)),t.trigger("request",t,e,n),e},u.ajax=function(){return u.$.ajax.apply(u.$,arguments)},h.extend=p.extend=d.extend=T.extend=b.extend=function(e,t){var n=this,r;r=e&&a.has(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)},a.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&a.extend(r.prototype,e),r.__super__=n.prototype,r};var L=function(){throw Error('A "url" property or function must be specified')}}.call(this),window&&(window.Backbone=n),n});